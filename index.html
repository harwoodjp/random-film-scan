<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        img {
          width: 50vw;
        }
    </style>
</head>
<body>
    <img onclick="update()"></img>

    <script>
        const getIndex = max => String(Math.random() * max).split(".")[0]
        const img = document.querySelector("img")
        let available = JSON.parse(window.localStorage.getItem("data"))

        // on load
        fetch("data.json")
            .then(response => response.json())
            .then(data => {
                if (available == null || available.length == 0 || available.length == 1) {
                    window.localStorage.setItem("data", JSON.stringify(data))
                    available = data.map(d => d)            
                }
                const index = getIndex(available.length)
                img.src = `http://${available[index].bucketName}/${available[index].key.replace(" ", "%20")}`
                available.splice(index, 1)
                window.localStorage.setItem("data", JSON.stringify(available))
            })



        // on click
        const update = () => {
            console.log(`UPDATE: available length ${available.length}`)
            if (available == null || available.length == 0 || available.length == 1)
                location.reload();
            const index = getIndex(available.length)
            console.log(`UPDATE: setting img to available[${index}] of available length ${available.length}`)                       
            img.src = `http://${available[index].bucketName}/${available[index].key.replace(" ", "%20")}`
            available.splice(index, 1)          
        }

    </script>
</body>
</html>